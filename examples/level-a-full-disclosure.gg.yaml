# GenesisGraph Example: Level A â€” Full Disclosure
# Use case: AI inference pipeline for medical question answering
# All parameters, configurations, and provenance fully visible

spec_version: 0.1.0

profile: gg-ai-basic-v1

imports:
  - https://genesisgraph.dev/ns/core/0.1
  - https://genesisgraph.dev/ns/ai/0.1

namespaces:
  ai: https://genesisgraph.dev/ns/ai/0.1

context:
  environment: docker://ubuntu:22.04@sha256:abc123def456
  hardware: nvidia_a100
  location: datacenter-us-west-2
  software_env: conda:pytorch_2.1#sha256:789abc012def

tools:
  - id: retrieval_engine
    type: Software
    vendor: InternalAI
    version: 3.2.1
    capabilities:
      search:
        max_results: 100
        vector_similarity: cosine
        rerank: true

  - id: llama3_70b
    type: AIModel
    vendor: Meta
    version: 3.0
    capabilities:
      inference:
        max_tokens: 8192
        temperature_range: [0.0, 2.0]
        top_p_range: [0.0, 1.0]
    identity:
      did: did:model:llama3-70b-instruct

  - id: moderation_filter
    type: Software
    vendor: InternalAI
    version: 2.1.0
    capabilities:
      moderation:
        categories: [medical, legal, harmful]
        confidence_threshold: 0.85

  - id: clinician_reviewer
    type: Human
    identity:
      did: did:person:dr_sarah_chen
      certificate: "Medical License CA-MD-98765"

entities:
  - id: medical_corpus
    type: Dataset
    version: 2025-10-15
    uri: s3://medical-kb/corpus-2025-10-15.parquet
    hash: sha256:a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2

  - id: retrieval_results
    type: Dataset
    version: "1"
    file: ./retrieval_results.json
    hash: sha256:f1e2d3c4b5a6978899001122334455667788990011223344556677889900aabb
    derived_from: [medical_corpus@2025-10-15]

  - id: prompt_template
    type: TextTemplate
    version: 1.3.0
    file: ./templates/medical_qa_prompt.txt
    hash: sha256:1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef

  - id: raw_answer
    type: Text
    version: "1"
    file: ./raw_answer.txt
    hash: sha256:fedcba0987654321fedcba0987654321fedcba0987654321fedcba0987654321
    derived_from: [retrieval_results@1, prompt_template@1.3.0]

  - id: moderated_answer
    type: Text
    version: "1"
    file: ./moderated_answer.txt
    hash: sha256:aabbccddeeff00112233445566778899aabbccddeeff00112233445566778899
    derived_from: [raw_answer@1]

  - id: final_answer
    type: Text
    version: "1"
    file: ./final_answer.txt
    hash: sha256:99887766554433221100ffeeddccbbaa99887766554433221100ffeeddccbbaa
    derived_from: [moderated_answer@1]

operations:
  - id: op_retrieval_001
    type: ai_retrieval
    inputs: [medical_corpus@2025-10-15]
    outputs: [retrieval_results@1]
    tool: retrieval_engine@3.2.1
    parameters:
      query: "What are the contraindications for metformin in patients with CKD?"
      max_results: 10
      similarity_threshold: 0.75
      rerank: true
    metrics:
      results_returned: 8
      max_similarity: 0.92
      avg_similarity: 0.81
      latency_ms: 245
    attestation:
      mode: signed
      signer: did:svc:retrieval-prod
      signature: ed25519:sig1_aabbccdd
      timestamp: 2025-10-31T14:23:11Z

  - id: op_inference_001
    type: ai_inference
    inputs: [retrieval_results@1, prompt_template@1.3.0]
    outputs: [raw_answer@1]
    tool: llama3_70b@3.0
    parameters:
      temperature: 0.2
      top_p: 0.9
      max_tokens: 512
      prompt_length_chars: 3842
      system_prompt: "You are a medical information assistant. Provide accurate, evidence-based answers."
    fidelity:
      expected: lossless
      actual:
        temperature: 0.2
        tokens_generated: 387
    metrics:
      inference_time_ms: 1823
      tokens_per_second: 212.4
    attestation:
      mode: signed
      signer: did:model:llama3-70b-instruct
      signature: ed25519:sig2_eeffaabb
      timestamp: 2025-10-31T14:23:13Z
    resource_usage:
      cpu_seconds: 0.8
      gpu_ms: 1823
      memory_mb: 4096
      energy_kj_estimate: 12.4

  - id: op_moderation_001
    type: ai_moderation
    inputs: [raw_answer@1]
    outputs: [moderated_answer@1]
    tool: moderation_filter@2.1.0
    parameters:
      categories: [medical, harmful]
      redact_mode: false
      flag_only: true
    metrics:
      flags_raised: 0
      confidence_medical: 0.98
      confidence_harmful: 0.02
    attestation:
      mode: signed
      signer: did:svc:moderation-prod
      signature: ed25519:sig3_11223344
      timestamp: 2025-10-31T14:23:14Z

  - id: op_human_review_001
    type: human_review
    inputs: [moderated_answer@1]
    outputs: [final_answer@1]
    tool: clinician_reviewer@
    parameters:
      review_type: medical_accuracy
      changes_made: false
      approval_granted: true
    metrics:
      review_time_seconds: 142
    attestation:
      mode: verifiable
      signer: did:person:dr_sarah_chen
      signature: ed25519:sig4_aabbccdd99887766
      timestamp: 2025-10-31T14:25:36Z
      delegation: did:org:hospital-system-west

metadata:
  request_id: req-2025-10-31-14-23-11-xyz
  user_session: sess-abc123
  compliance_framework: HIPAA
  retention_policy: 7_years
